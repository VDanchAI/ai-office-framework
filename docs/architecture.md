# Архитектура

## Что такое AI Office?

AI Office — система из 10 специализированных AI-ботов для маркетинга и контента. Вместо одного универсального помощника, который делает всё посредственно — узкие специалисты, каждый глубоко в своём домене.

Один бот = один Claude Project со своими инструкциями, базой знаний и правилами поведения. Вместе они образуют виртуальную команду.

## Ключевая идея

**Один бот на одну функцию. Глубина важнее широты.**

Копирайтер, который пишет как человек. Аналитик, который не отдаёт цифры без рекомендации. Маркетолог, который сначала спорит с идеей, потом делает. Визионер, который говорит то что не хочется слышать.

Это не одинаковые ассистенты с разными именами. У каждого бота:
- Своя **база знаний** (экспертиза, техники, фреймворки)
- Свои **инструкции** (правила, ограничения, рабочие процессы)
- Общее **ядро** (протоколы для всех ботов)
- **Аддоны** (дополнительные знания под задачу)

## Стек документов

Каждый бот в AI Office загружает документы в таком порядке:

```
┌─────────────────────────────────────────────┐
│  1. Universal Core                          │
│     Общие правила для ВСЕХ ботов            │
│     Протоколы: уточнение, анализ, проверка  │
│     Коммуникация, контроль качества         │
├─────────────────────────────────────────────┤
│  2. Project Instructions                    │
│     КТО этот бот (личность, границы)        │
│     КАК он себя ведёт (железные правила)    │
│     ЧТО он выдаёт (форматы ответов)        │
├─────────────────────────────────────────────┤
│  3. Knowledge Base + Router                 │
│     ЧТО он знает (экспертиза домена)        │
│     Router = навигация (JSON)               │
│     Загружается только нужная секция,        │
│     не вся KB                               │
├─────────────────────────────────────────────┤
│  4. Add-ons (опционально)                   │
│     Доп. знания под задачу                  │
│     Брендбук, спецификации, тулкиты         │
│     Шарятся между ботами при необходимости  │
└─────────────────────────────────────────────┘
```

## Система приоритетов

При конфликте источников побеждает более высокий приоритет:

| Приоритет | Источник | Пример |
|-----------|----------|--------|
| 0 (высший) | Текущее сообщение пользователя | «Сделай короче» — перекрывает всё |
| 1 | Universal Core | Общие протоколы не могут быть переопределены отдельным ботом |
| 2 | Инструкции бота | Правила роли перекрывают содержание базы знаний |
| 3 | Предпочтения пользователя | Паттерны, выученные из истории разговора |
| 4 | База знаний | Экспертиза домена |
| 5 (низший) | Суждение бота | Собственные рассуждения, когда ничего другого не применимо |

## Система роутера

Боты не загружают всю базу знаний в контекст. Это тратит токены и размывает фокус. Вместо этого:

1. **Пользователь задаёт вопрос**
2. **Роутер** (JSON в начале KB) находит нужную секцию
3. **Бот загружает только эту секцию** в контекст
4. **Ответ формируется** на основе секции + инструкций

Два типа архитектуры роутера:

| Тип | Когда | Как работает |
|-----|-------|-------------|
| **Flat** | До ~20 секций | Одна таблица, прямой поиск |
| **Hierarchical** | 20+ секций | Master Router → домен → Sub-Router → секция |

> См. [Иерархия документов](document-hierarchy.md) — подробности о структуре.
> См. templates/ — примеры роутеров.

## Платформа

AI Office построен на **Claude Projects** (Anthropic). Один бот = один Claude Project.

**Почему Claude Projects:**
- Инструкции сохраняются между разговорами
- Файлы знаний загружаются в проект постоянно
- Проекты изолированы — боты не влияют друг на друга
- Память работает между сессиями внутри проекта

Можно адаптировать под другие платформы (GPT, API-системы), но придётся переделать загрузку документов и реализацию роутера.

## Чем это отличается

| | Типичный подход | AI Office |
|---|---|---|
| Роли | Один бот на всё | 10 специализированных ботов |
| Знания | Общие знания LLM | Собранные вручную базы знаний (1 000–27 000 строк на роль) |
| Навигация | Вся база грузится в контекст | Роутер загружает только нужную секцию |
| Поведение | «Полезный помощник» | Характер: спорит, критикует, имеет позицию |
| Качество | Надеемся на лучшее | Самопроверка, железные правила, цикл D.A.O.S. |
| Координация | Ручное копирование | Передача задач через формат REQUEST |

> См. [Обзор ролей](roles-overview.md) — все 10 ролей.
> См. [Как роли взаимодействуют](how-roles-interact.md) — паттерны коллаборации.
> См. [Руководство по сборке](deployment-guide.md) — как собрать своего бота.
