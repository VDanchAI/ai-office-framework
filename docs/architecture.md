# Архитектура

## Что такое AI Office?

AI Office — это система специализированных AI-ботов, каждый со своей ролью, вместе покрывающих маркетинг и контент. Вместо одного универсального помощника, который делает всё посредственно, — 10 узких специалистов, каждый глубоко в своём домене.

Один бот = один Claude Project со своими инструкциями, базой знаний и правилами поведения. Вместе они образуют виртуальную команду.

## Ключевая идея

**Один бот на одну функцию. Глубина важнее широты.**

Копирайтер, который пишет как человек. Аналитик, который не отдаёт данные без рекомендации. Маркетолог, который оспаривает плохие стратегии до выполнения. Визионер, который говорит неудобную правду о ваших планах.

Это не одинаковые ассистенты с разными именами. У каждого бота:
- Своя **база знаний** (экспертиза домена, техники, фреймворки)
- Свои **инструкции** (правила поведения, железные ограничения, рабочие процессы)
- Общее **Универсальное Ядро** (протоколы, которым следуют все боты)
- Опциональные **аддоны** (дополнительные знания под конкретные задачи)

## Стек документов

Каждый бот в AI Office загружает документы в таком порядке:

```
┌─────────────────────────────────────────────┐
│  1. Universal Core                          │
│     Общие правила для ВСЕХ ботов            │
│     Протоколы: уточнение, анализ, проверка  │
│     Коммуникация, контроль качества         │
├─────────────────────────────────────────────┤
│  2. Project Instructions                    │
│     КТО этот бот (личность, границы)        │
│     КАК он себя ведёт (железные правила)    │
│     ЧТО он выдаёт (форматы ответов)        │
├─────────────────────────────────────────────┤
│  3. Knowledge Base + Router                 │
│     ЧТО он знает (экспертиза домена)        │
│     Router = навигация (JSON)               │
│     Секции подгружаются по якорю,           │
│     не целиком                              │
├─────────────────────────────────────────────┤
│  4. Add-ons (опционально)                   │
│     Доп. знания под задачу                  │
│     Брендбук, спецификации, тулкиты         │
│     Шарятся между ботами при необходимости  │
└─────────────────────────────────────────────┘
```

## Система приоритетов

При конфликте источников побеждает более высокий приоритет:

| Приоритет | Источник | Пример |
|-----------|----------|--------|
| 0 (высший) | Текущее сообщение пользователя | «Сделай короче» — перекрывает всё |
| 1 | Universal Core | Общие протоколы не могут быть переопределены отдельным ботом |
| 2 | Инструкции бота | Правила роли перекрывают содержание базы знаний |
| 3 | Предпочтения пользователя | Паттерны, выученные из истории разговора |
| 4 | База знаний | Экспертиза домена |
| 5 (низший) | Суждение бота | Собственные рассуждения, когда ничего другого не применимо |

## Система роутера

Боты не загружают всю базу знаний в контекст. Это тратит токены и размывает фокус. Вместо этого:

1. **Пользователь задаёт вопрос**
2. **Роутер** (JSON-блок в начале KB) маппит запрос на секцию
3. **Бот переходит к секции** по якорю
4. **Загружается только эта секция** в контекст
5. **Бот формирует ответ** на основе секции + инструкций

Два типа архитектуры роутера:

| Тип | Когда | Как работает |
|-----|-------|-------------|
| **Flat** | До ~20 секций | Одна таблица, прямой поиск |
| **Hierarchical** | 20+ секций | Master Router → домен → Sub-Router → секция |

> См. [Иерархия документов](document-hierarchy.md) — подробности о структуре.
> См. templates/ — примеры роутеров.

## Платформа

AI Office построен на **Claude Projects** (Anthropic). Один бот = один Claude Project.

**Почему Claude Projects:**
- Инструкции проекта сохраняются между разговорами
- Файлы знаний загружаются в проект на постоянной основе
- Каждый проект изолирован — боты не влияют друг на друга
- Память сохраняется между сессиями внутри проекта

**Адаптация под другие платформы** (GPT, API-системы) возможна, но требует корректировки механизма загрузки документов и реализации роутера.

## Чем это отличается

| | Типичный подход | AI Office |
|---|---|---|
| Роли | Один бот на всё | 10 специализированных ботов |
| Знания | Общие знания LLM | Кураторские базы знаний (1 000–27 000 строк экспертизы на роль) |
| Навигация | Вся база грузится в контекст | Роутер подгружает только нужную секцию |
| Поведение | «Полезный помощник» | Определённый характер: спорит, критикует, имеет позицию |
| Качество | Надеемся на лучшее | Протоколы самопроверки, железные правила, цикл D.A.O.S. |
| Координация | Ручное копирование | Структурированные передачи через формат REQUEST |

> См. [Обзор ролей](roles-overview.md) — все 10 ролей.
> См. [Как роли взаимодействуют](how-roles-interact.md) — паттерны коллаборации.
> См. [Руководство по сборке](deployment-guide.md) — как собрать своего бота.
