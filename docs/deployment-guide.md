# Руководство по развёртыванию — как собрать своего бота

Это руководство проведёт вас через развёртывание одного бота или целого ИИ-офиса с использованием фреймворка из этого репозитория. Следуйте шагам по порядку. При первом прохождении ничего не пропускайте.

---

## 1. Предварительные требования

Перед началом сборки убедитесь, что у вас есть:

- **Аккаунт Claude Pro или Team** — необходим для Claude Projects (механизм хостинга каждого бота)
- **Экспертиза в вашей предметной области** — бот усиливает то, что вы уже знаете; он не может заменить знания, которых у вас нет
- **Чёткая роль и границы** — понимайте, что этот бот делает, и, не менее важно, что он не делает

Если роль ещё не ясна, сначала прочитайте `docs/architecture.md`.

---

## 2. Пошаговая инструкция: сборка одного бота

### Шаг 1: Определите роль

Начните отсюда, а не с контента. Бот с размытой ролью будет дрейфовать и давать сбои.

1. Напишите **описание роли из 2-3 предложений** — кто этот бот, какой домен покрывает
2. Сформулируйте одну **главную директиву** — единственную важнейшую цель, ради которой существует этот бот
3. Перечислите **что бот ДЕЛАЕТ** (5-10 конкретных действий)
4. Перечислите **что бот НЕ делает** (не менее 3 явных исключений)

> **Отправная точка:** `templates/TEMPLATE_INSTRUCTIONS.md`

**Совет:** Если вы не можете сформулировать главную директиву в одном предложении — роль ещё не определена. Продолжайте думать.

---

### Шаг 2: Соберите базу знаний

KB — это место, где живёт экспертиза бота. Структура важна не меньше, чем контент.

1. Определите **5-10 ключевых тем**, которые боту нужно знать для работы
2. Для каждой темы напишите секцию с:
   - Правилом или принципом
   - Объяснением, почему это важно
   - Практической техникой или чеклистом
   - Одним конкретным примером
3. Создайте **роутер** в начале KB — JSON-блок, который сопоставляет триггеры пользовательских запросов с нужной секцией
4. Используйте **якоря** для связи записей роутера с секциями: `#S1_TOPIC_NAME`

**Структура роутера (плоский роутер, для до ~20 секций):**

```json
{
  "router": [
    {
      "trigger": ["keyword1", "keyword2", "phrase"],
      "section": "#S1_TOPIC_NAME",
      "description": "Когда использовать эту секцию"
    }
  ]
}
```

> **Отправная точка:** `templates/TEMPLATE_KB.md`

> **Когда переключаться:** Если вы достигли 20+ секций, переходите на иерархический роутер. См. `templates/TEMPLATE_ROUTER.json`.

**Предупреждение:** KB без роутера заставляет бота загружать всё при каждом запросе. Это расходует токены и снижает качество ответов. Всегда включайте роутер.

---

### Шаг 3: Напишите инструкции

Файл инструкций определяет личность бота, его поведение и ограничения. Именно это вставляется в поле Custom Instructions в Claude.

Заполните `templates/TEMPLATE_INSTRUCTIONS.md`. Особое внимание уделите этим трём секциям:

| Секция | Что контролирует | Чего стоит ошибка |
|---|---|---|
| **Личность** | Кто такой бот, его голос и роль | Дрейф роли — бот пытается быть всем сразу |
| **Область действия** | Что бот обрабатывает, а что передаёт другим | Расширение области — бот делает работу, которую не должен |
| **Железные правила** | Неоспоримые ограничения, всегда соблюдаются | Непредсказуемое поведение, непоследовательный результат |

**Рекомендации по железным правилам:**
- Стремитесь к 5-10 правилам (меньше = пробелы, больше = путаница)
- Каждое правило должно быть **проверяемым** — вы можете посмотреть на ответ и убедиться, выполнено правило или нарушено
- Плохое правило: "Будь полезным" — не проверяемо
- Хорошее правило: "Никогда не писать текст без определённой целевой аудитории в брифе" — проверяемо

**Всегда включайте секцию "Кем я НЕ являюсь".** Перечислите 3-5 ролей, которые этот бот не выполняет. Это одно дополнение предотвращает большинство проблем с дрейфом роли.

---

### Шаг 4: Настройте Universal Core

Universal Core — это общий файл, который входит в каждый бот вашего офиса. Он содержит правила и протоколы, применимые везде.

1. Скопируйте `templates/TEMPLATE_CORE.md`
2. Задайте **язык** (язык, на котором общаются все боты)
3. Определите **стиль общения** (тон, предпочтения формата, настройки длины ответов по умолчанию)
4. Настройте **протоколы качества** (шаги самопроверки, которые бот выполняет перед ответом)
5. Добавьте любые **общеорганизационные ограничения**, применимые ко всем ролям

> Если вы собираете только одного бота, Universal Core всё равно важен — он обеспечивает чёткое разделение между специфическими для роли правилами (инструкции) и универсальными правилами (Core).

---

### Шаг 5: Создайте проект Claude

1. Перейдите в **Claude → Projects → New Project**
2. Назовите проект по роли бота (например, "Copywriter", "Analyst")
3. Вставьте готовые инструкции в поле **"Custom Instructions"**
4. Загрузите файлы в проект:
   - `universal-core.md` (обязательно)
   - Файл вашей базы знаний (обязательно)
   - Любые файлы аддонов, релевантные для этой роли (опционально)
5. Запустите **5+ реальных запросов** — запросы, которые вы реально отправите в продакшене

**Совет:** Используйте запросы, которые покрывают граничные случаи, а не только идеальные. Тестируйте границы при первом прогоне.

---

### Шаг 6: Тестируйте и итерируйте

Выполните каждую из этих проверок, прежде чем считать бота готовым к продакшену:

| Тест | Что проверяем | Как исправить при сбое |
|---|---|---|
| **Тест роутера** | Находит ли бот и загружает ли правильную секцию KB? | Добавьте или уточните ключевые слова-триггеры в роутере |
| **Тест ограничений** | Выполняет ли бот каждое железное правило? | Перепишите расплывчатые правила, сделав их проверяемыми |
| **Тест границ** | Остаётся ли бот в области действия и отклоняет ли запросы вне неё? | Усильте секцию "Кем я НЕ являюсь" и секцию области действия |
| **Тест делегирования** | Корректно ли бот передаёт задачи другим ролям? | Добавьте или исправьте триггеры передачи и формат REQUEST |
| **Тест качества** | Стабильно ли качество вывода по разным типам запросов? | Улучшите шаги самопроверки в Universal Core |

Итерируйте в таком порядке: скорректируйте триггеры → ужесточьте правила → добавьте примеры → протестируйте снова. Не добавляйте больше контента, пока роутер и железные правила не работают корректно.

---

## 3. Масштабирование до нескольких ботов (ИИ-офис)

Создание ИИ-офиса — аддитивный процесс. Не пытайтесь проектировать всю систему заранее.

**Последовательность, которая работает:**

1. **Соберите одного бота.** Добейтесь хорошей работы. Запустите. Используйте.
2. **Добавьте второго бота** с чётко определённой границей от первого. Задокументируйте, какие запросы куда идут.
3. **Создайте Universal Core** — извлеките правила, применимые к обоим ботам, централизуйте их. Оба бота теперь используют этот файл.
4. **Добавьте карту ИИ-офиса** — JSON-файл со списком всех активных ролей, их главными директивами и указанием, когда роутить к каждой. Концепцию карты ИИ-офиса см. в [how-roles-interact.md](how-roles-interact.md).
5. **Создайте протоколы передачи** — определите формат REQUEST, который боты используют при делегировании задач друг другу. Единый формат предотвращает сбои при передаче.
6. **Добавляйте ботов по одному.** Тестируйте каждый новый путь передачи перед добавлением следующего бота.

**Совет:** Карта ИИ-офиса становится навигационным слоем всей системы. Обновляйте её каждый раз при добавлении роли.

---

## 4. Типичные ошибки

Это наиболее частые точки отказа. Прочитайте их до начала сборки, а не после.

**1. Начало с контента, а не с определения роли**
Вы пишете 2000 слов контента KB до того, как решили, какова главная директива бота. Контент получается разрозненным, и роутер не может его организовать.
Исправление: сначала определите роль, главную директиву и область действия. Начинайте KB только после того, как Шаг 1 зафиксирован.

**2. Слишком широкая KB**
Вы пытаетесь охватить всё, косвенно связанное с ролью. Бот становится универсалом с поверхностными знаниями.
Исправление: глубокая экспертиза в узком домене лучше широкого охвата. Убирайте любую секцию, которая не является необходимой для главной директивы.

**3. Нет роутера**
Бот загружает всю KB при каждом запросе. Расход токенов высок, ответы медленные, релевантность снижается.
Исправление: всегда включайте роутер. Даже KB из 3 секций выигрывает от него. Это не опция.

**4. Расплывчатые железные правила**
Правила вроде "будь профессиональным" или "давай хорошие советы" звучат разумно, но не поддаются контролю.
Исправление: перепишите каждое железное правило так, чтобы вы могли посмотреть на ответ и однозначно сказать: выполнено или нарушено. Если не получается — правило нужно переписать.

**5. Нет секции "Кем я НЕ являюсь"**
Без явных исключений бот берётся за задачи вне своей области — сначала редко, потом систематически.
Исправление: добавьте не менее 3 явных утверждений "Я не \_\_\_, я не делаю \_\_\_" в инструкции.

**6. Пропуск протокола самопроверки**
Бот выдаёт результат без проверки его на соответствие критериям качества.
Исправление: добавьте секцию самопроверки в Universal Core. Даже 3-шаговая проверка (точность, тон, полнота) заметно улучшает стабильность вывода.

**7. Слишком много ботов слишком быстро**
Вы проектируете 6 ботов до того, как первый заработал. Передачи ломаются, роли перекрываются, отладка превращается в кошмар.
Исправление: один бот, полностью рабочий, в реальном использовании. Затем второй. Затем третий. Совокупная ценность офиса появляется только тогда, когда каждый компонент надёжен.

---

## 5. Рекомендуемый порядок сборки

Если вы строите полный ИИ-офис с нуля, этот порядок даёт самый быстрый путь к результату:

| Приоритет | Роль | Почему в таком порядке |
|---|---|---|
| 1 | **Копирайтер** | Максимальный немедленный ROI — производство контента нужно всегда, результаты видны быстро |
| 2 | **Маркетолог** | Добавляет стратегический слой к контенту, который производит Копирайтер; две роли усиливают друг друга |
| 3 | **Аналитик** | Измеряет то, что производят первые двое; замыкает петлю обратной связи |
| 4 | **Продюсер** | Координация становится ценной, когда есть 3+ роли для координации |
| 5+ | Остальные роли | Добавляйте исходя из реальных узких мест, а не теоретической оргсхемы |

**Предупреждение:** Не добавляйте Продюсера до запуска нескольких ботов. Координатор без объектов координации — впустую потраченные усилия.

---

## 6. Краткий справочник

| Хочу... | Начать с... | Шаблон |
|---|---|---|
| Собрать одного бота | Шаги 1-6 в Секции 2 | `TEMPLATE_KB.md` + `TEMPLATE_INSTRUCTIONS.md` |
| Собрать полный ИИ-офис | Секция 3 (последовательность масштабирования) | Все шаблоны + `TEMPLATE_CORE.md` |
| Добавить специализацию существующему боту | Файл аддона для этой специализации | `TEMPLATE_ADDON.md` |
| Масштабировать большую KB (20+ секций) | Иерархический роутер | `TEMPLATE_ROUTER.json` |
| Отладить дрейфующего бота | Тесты ограничений и границ (Секция 2, Шаг 6) | Проверьте железные правила в `TEMPLATE_INSTRUCTIONS.md` |
| Настроить общие правила для всех ботов | Universal Core (Секция 2, Шаг 4) | `TEMPLATE_CORE.md` |

---

## Связанная документация

- [architecture.md](architecture.md) — как компоненты фреймворка связаны между собой
- [document-hierarchy.md](document-hierarchy.md) — детальный разбор структуры документов и дизайна роутера
- [roles-overview.md](roles-overview.md) — все 10 ролей и их специализации
- [how-roles-interact.md](how-roles-interact.md) — паттерны взаимодействия и формат REQUEST
- `templates/TEMPLATE_INSTRUCTIONS.md` — шаблон инструкций со встроенными комментариями
- `templates/TEMPLATE_KB.md` — шаблон плоской KB с примером роутера
- `templates/TEMPLATE_CORE.md` — шаблон Universal Core
- `templates/TEMPLATE_ADDON.md` — шаблон модуля-аддона
- `templates/TEMPLATE_ROUTER.json` — иерархический роутер для больших KB
